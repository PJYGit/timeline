# 数据建模

## 概念结构

​	构成 E-R 图的 3 个基本要素是实体、属性和联系。实体之间有三种关系：一 对一、一对多、多对多。实体与实体之间的联系也可以有属性。 

​	通过对系统的分析，抽象出的实体主要有：用户、任务、记录和组等。各实体之间的E-R关系图如图所示：（可能待调整）

![avatar](ER.png)

## 逻辑结构

​	根据系统需求和功能模块设计以及数据库概念模型 E-R 图的设计，共设计了 9 张数据基本表。

​	后续还会对系统进行优化，开发更多新模块，因此在表的设计中需要保证未来可拓展性。 各模块的关系模型如下：

​	(1) 注册用户表（用户ID，QQ号，微信号，手机号，密码）

​	(2) 在线用户表（用户ID，对应token）

​	(3) 用户信息表（用户ID，昵称，注册时间，是否VIP）

​	(4) 任务表（任务ID，用户ID，组ID，任务标题，任务开始时间，任务结束时间，任务描述，任务重复类别）

​	(5) 记录体表（记录ID，用户ID，记录标题，记录时间，记录描述）

​	(6) 记录图片表（记录ID，图片ID，图片排序位置）

​	(7) 组申请记录表（组ID，用户ID）

​	(8) 组成员表（组ID，用户ID）

​	(9) 组信息表（组ID，组成员ID，组名）

​	以上数据表中，各表主键均已在途中用金色钥匙🔑符号标出，由于外键的约束会导致复杂的 删除问题，降低效率，所以在数据表的设计中没有设置外键。 

## 物理结构

### 注册用户表

| 列名     | 类型        | 描述                 |
| -------- | ----------- | -------------------- |
| uid      | INT         | 用户ID               |
| qqid     | VARCHAR(32) | 用户注册使用的QQ号   |
| wechatid | VARCHAR(32) | 用户注册使用的微信号 |
| phone    | VARCHAR(20) | 用户注册使用的手机号 |
| pwd      | VARCHAR(32) | 用户的注册密码       |

### 在线用户表

| 列名  | 类型        | 描述                |
| ----- | ----------- | ------------------- |
| uid   | INT         | 用户ID              |
| token | VARCHAR(32) | 和uid一起做身份验证 |

### 用户信息表

| 列名     | 类型   | 描述         |
| -------- | ------ | ------------ |
| uid      | INT    | 用户ID       |
| nickname | INT    | 用户昵称     |
| regtime  | BIGINT | 用户注册时间 |
| isVIP    | INT    | 是否为VIP    |

### 任务表

| 列名   | 类型   | 描述                       |
| ------ | ------ | -------------------------- |
| tid    | INT    | 任务ID                     |
| uid    | INT    | 用户ID                     |
| gid    | INT    | 组ID（-1代表非组任务）     |
| title  | TEXT   | 任务标题                   |
| begin  | BIGINT | 任务开始时间               |
| end    | BIGINT | 任务结束时间               |
| detail | TEXT   | 任务描述                   |
| type   | INT    | 任务重复类型（每日每周等） |

### 记录体表

| 列名   | 类型   | 描述           |
| ------ | ------ | -------------- |
| rid    | INT    | 记录ID         |
| uid    | INT    | 用户ID         |
| title  | TEXT   | 记录标题       |
| time   | BIGINT | 记录创建的时间 |
| detail | TEXT   | 记录描述       |

### 记录图片表

| 列名  | 类型        | 描述         |
| ----- | ----------- | ------------ |
| rid   | INT         | 记录ID       |
| picid | VARCHAR(64) | 图片ID       |
| pos   | INT         | 图片排序位置 |

### 组申请记录表

| 列名 | 类型 | 描述   |
| ---- | ---- | ------ |
| gid  | INT  | 组ID   |
| uid  | INT  | 用户ID |

### 组成员表

| 列名 | 类型 | 描述   |
| ---- | ---- | ------ |
| gid  | INT  | 组ID   |
| uid  | INT  | 用户ID |

### 组信息表

| 列名  | 类型 | 描述         |
| ----- | ---- | ------------ |
| gid   | INT  | 组ID         |
| muid  | INT  | 组成员用户ID |
| gname | TEXT | 组名         |

